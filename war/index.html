<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- The HTML 4.01 Transitional DOCTYPE declaration-->
<!-- above set at the top of the file will set     -->
<!-- the browser's rendering engine into           -->
<!-- "Quirks Mode". Replacing this declaration     -->
<!-- with a "Standards Mode" doctype is supported, -->
<!-- but may lead to some differences in layout.   -->

<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>App Engine</title>
  
     <script type="text/javascript">
  /*
   * Activado cuando el usuario acepta el inicio de sesiÃ³n, cancela o cierra el
   * cuadro de diÃ¡logo de autorizaciÃ³n.
   */
  function signinCallback(authResult) 
  {
    if (authResult) 
    {
    	confirm("authResult");
    	if (authResult['error'] == undefined)
	    {
	        gapi.auth.setToken(authResult); // Almacena el token recuperado.
	        toggleElement('signinButton'); // Oculta el inicio de sesion si se ha accedido correctamente.
	        getEmail();                    // Activa la solicitud para obtener la direcciÃ³n de correo electrÃ³nico.
	        confirm("undefined");
	    } 
	    else 
	    {
	    	console.log('An error occurred');
	    }
    } 
    else
    {
    	alert("Empty authResult");
      console.log('Empty authResult');  // Se ha producido algÃºn error
    }
  }

  /*
   * Inicia la solicitud del punto final userinfo para obtener la direccion de correo electronico del
   * usuario. Esta funcion se basa en gapi.auth.setToken que contiene un token
   * de acceso de OAuth valido.
   *
   * Cuando se completa la solicitud, se activa getEmailCallback y recibe
   * el resultado de la solicitud.
   */
  function getEmail()
  {
	alert("getEmail ");
    // Carga las bibliotecas oauth2 para habilitar los metodos userinfo.
    gapi.client.load('oauth2', 'v2', function() 
   	{
    	var request = gapi.client.oauth2.userinfo.get();
    	
        request.execute(getEmailCallback);
        llamaServlet();
    });
  }
  
  function llamaServlet()
  {
	  alert("llamaServlet ");
	  
	  
  }
  
  

  function getEmailCallback(obj)
  {
  	  var el = document.getElementById('email');
  	  alert("getEmailCallback 1 ");
      var email = '';

      if (obj['email']) 
      {
    	  alert("getEmailCallback 2");
      	  email = 'Email: ' + obj['email'];
      }

    console.log(obj);   // Sin comentario para inspeccionar el objeto completo.

    el.innerHTML = email;
    //toggleElement('email');
  }

  function toggleElement(id) {
    var el = document.getElementById(id);
    if (el.getAttribute('class') == 'hide') 
    {
     	el.setAttribute('class', 'show');
    } 
    else 
    {
      el.setAttribute('class', 'hide');
    }
  }
  </script>
    
    
  </head>

  <body>
    <h1>App Engine!</h1>
	
    <table>
      <tr>
        <td colspan="2" style="font-weight:bold;">Available Servlets:</td>        
      </tr>
      <tr>
        <td><a href="loginexample">LoginExample</a></td>
      </tr>
    </table>
    <span id="signinButton">
	  	<span
		    class="g-signin"
		    data-callback="signinCallback"
		    data-clientid="18651616556-bnmp1spp3jolvo2lhu317e8bn55l7bpa.apps.googleusercontent.com"
		    data-cookiepolicy="single_host_origin"
		    data-requestvisibleactions="http://schemas.google.com/AddActivity"
		    data-scope="https://www.googleapis.com/auth/plus.login">
	  	</span>
	</span>
  </body>
  
  <!-- Coloca este JavaScript asíncrono justo delante de la etiqueta </body> -->
    <script type="text/javascript">
    	(function() 
    	{
    		var po = document.createElement('script');
    		po.type = 'text/javascript'; 
    		po.async = true;
	       	po.src = 'https://apis.google.com/js/client:plusone.js';
	       	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
     	})();
    	
    	
    	
    	
    	
    	
    </script>
  
  
  
</html>
